(self.webpackChunkapp=self.webpackChunkapp||[]).push([[310],{4310:(e,i,o)=>{"use strict";o.r(i),o.d(i,{CineArBoleteriaModule:()=>B});var n=o(2322),t=o(1146),c=o(2290),a=o(2844),r=o(6603),l=o(6612);class s{constructor(e,i,o,n,t){this.funcion=e,this.asientoIdSelected=i,this.precioIdQuantitySelected=o,this.email=n,this.nombre=t}}class d{constructor(e,i){this.precioId=e,this.quantity=i}}var p=o(8619),u=o(9121),g=o(7419),h=o(2353),Z=o(2693);let f=(()=>{class e{constructor(e){this.http=e,this.resourceUrl=h.B+"JavaTPI/precio"}query(){return this.http.get(this.resourceUrl,{params:{},observe:"response"})}}return e.\u0275fac=function(i){return new(i||e)(p.LFG(Z.eN))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=o(1116);let m=(()=>{class e{constructor(e){this.http=e,this.resourceUrl=h.B+"JavaTPI/asiento"}query_occupied_by_funcion(e){return this.http.get(this.resourceUrl,{params:{funcionId:e},observe:"response"})}}return e.\u0275fac=function(i){return new(i||e)(p.LFG(Z.eN))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),T=(()=>{class e{constructor(e){this.http=e,this.resourceUrl=h.B+"JavaTPI/compra"}buy_tickets_to_funcion(e){return console.log(e),this.http.post(`${this.resourceUrl}`,e,{observe:"response"})}}return e.\u0275fac=function(i){return new(i||e)(p.LFG(Z.eN))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var S=o(9848),v=o(4568),q=o(1462),x=o(6726),A=o(3157),M=o(9892),y=o(552);function _(e,i){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",4),p.TgZ(2,"label",18),p._uU(3,"Formato"),p.qZA(),p.TgZ(4,"p-dropdown",19),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().formatoSeleccionado=i})("ngModelChange",function(){return p.CHM(e),p.oxw().onFormatoSelected()}),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=p.oxw();p.xp6(4),p.Q6J("options",e.peliculaSeleccionado.formatos)("ngModel",e.formatoSeleccionado)("required",!0)("showClear",!0)}}function C(e,i){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"div",4),p.TgZ(2,"label",20),p._uU(3,"Funcion"),p.qZA(),p.TgZ(4,"p-dropdown",21),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().funcionSeleccionado=i})("ngModelChange",function(){return p.CHM(e),p.oxw().onFuncionSelected()}),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=p.oxw();p.xp6(4),p.Q6J("options",e.funciones)("ngModel",e.funcionSeleccionado)("required",!0)("showClear",!0)}}function U(e,i){1&e&&(p.TgZ(0,"tr"),p.TgZ(1,"th"),p._uU(2,"Boleto"),p.qZA(),p.TgZ(3,"th"),p._uU(4,"Valor"),p.qZA(),p.TgZ(5,"th"),p._uU(6,"Cantidad"),p.qZA(),p.TgZ(7,"th"),p._uU(8,"Sub Total"),p.qZA(),p.qZA())}function J(e,i){if(1&e){const e=p.EpF();p.TgZ(0,"tr"),p.TgZ(1,"td"),p._uU(2),p.qZA(),p.TgZ(3,"td"),p.TgZ(4,"strong"),p._uU(5),p.qZA(),p.qZA(),p.TgZ(6,"td"),p.TgZ(7,"input",25,26),p.NdJ("change",function(){const i=p.CHM(e).$implicit,o=p.MAs(8);return p.oxw(2).onPrecioChange(i,o.value)}),p.qZA(),p.qZA(),p.TgZ(9,"td"),p.TgZ(10,"strong"),p._uU(11),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=i.$implicit,o=p.oxw(2);p.xp6(2),p.Oqu(e.tipoPrecio.nombre),p.xp6(3),p.hij("$ ",e.valor," "),p.xp6(6),p.hij("$ ",o.calculateSubtotal(e)," ")}}function w(e,i){if(1&e&&(p.ynx(0),p.TgZ(1,"div",4),p.TgZ(2,"p-table",22),p.YNc(3,U,9,0,"ng-template",23),p.YNc(4,J,12,3,"ng-template",24),p.qZA(),p.qZA(),p.BQk()),2&e){const e=p.oxw();p.xp6(2),p.Q6J("value",e.precios)}}function F(e,i){if(1&e&&(p.ynx(0),p.TgZ(1,"div",4),p.TgZ(2,"p"),p._uU(3),p.TgZ(4,"b"),p._uU(5),p.qZA(),p.qZA(),p.qZA(),p.BQk()),2&e){const e=p.oxw();p.xp6(3),p.hij("Siendo ",e.calculateTotalElegido()," asientos dando un total de "),p.xp6(2),p.hij("$ ",e.calculateTotal(),"")}}const N=function(e,i,o,n){return{"p-button-info":e,"p-button-success":i,"p-button-danger":o,"p-button-secondary":n}};function Q(e,i){if(1&e){const e=p.EpF();p.TgZ(0,"div",29),p._UZ(1,"br"),p.TgZ(2,"div",30),p._uU(3),p.qZA(),p.TgZ(4,"button",31),p.NdJ("click",function(){const i=p.CHM(e).$implicit;return p.oxw(2).onAsientoSelected(i.id)}),p.qZA(),p.qZA()}if(2&e){const e=i.$implicit;p.xp6(3),p.Oqu(e.nombre),p.xp6(1),p.Q6J("ngClass",p.l5B(3,N,e.disponible&&!e.adaptado&&!e.seleccionado,e.disponible&&e.adaptado&&!e.seleccionado,!e.disponible,e.seleccionado))("disabled",!e.disponible)}}function I(e,i){if(1&e&&(p.TgZ(0,"div",27),p.YNc(1,Q,5,8,"div",28),p.qZA()),2&e){const e=i.$implicit;p.xp6(1),p.Q6J("ngForOf",e)}}function k(e,i){if(1&e){const e=p.EpF();p.ynx(0),p.TgZ(1,"form",32,33),p.NdJ("ngSubmit",function(){return p.CHM(e),p.oxw().onSubmit()}),p.TgZ(3,"div",4),p.TgZ(4,"label",34),p._uU(5,"Email"),p.qZA(),p.TgZ(6,"input",35),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().email=i}),p.qZA(),p.qZA(),p.TgZ(7,"div",4),p.TgZ(8,"label",36),p._uU(9,"Nombre Titular"),p.qZA(),p.TgZ(10,"input",37),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().nombre=i}),p.qZA(),p.qZA(),p.TgZ(11,"div",4),p.TgZ(12,"label",38),p._uU(13,"Numero Tarjeta"),p.qZA(),p.TgZ(14,"input",39),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().cc=i}),p.qZA(),p.qZA(),p.TgZ(15,"div",40),p.TgZ(16,"div",41),p.TgZ(17,"label",42),p._uU(18,"Mes Expiracion"),p.qZA(),p.TgZ(19,"input",43),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().me=i}),p.qZA(),p.qZA(),p.TgZ(20,"div",41),p.TgZ(21,"label",44),p._uU(22,"A\xf1o Expiracion"),p.qZA(),p.TgZ(23,"input",45),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().ae=i}),p.qZA(),p.qZA(),p.TgZ(24,"div",41),p.TgZ(25,"label",46),p._uU(26,"Codigo Verificacion"),p.qZA(),p.TgZ(27,"input",47),p.NdJ("ngModelChange",function(i){return p.CHM(e),p.oxw().cvef=i}),p.qZA(),p.qZA(),p.qZA(),p.TgZ(28,"div",48),p.TgZ(29,"div",49),p.TgZ(30,"button",50),p.NdJ("click",function(){return p.CHM(e),p.oxw().previousState()}),p.qZA(),p.qZA(),p.TgZ(31,"div",49),p._UZ(32,"button",51),p.qZA(),p.qZA(),p.qZA(),p.BQk()}if(2&e){const e=p.MAs(2),i=p.oxw();p.xp6(6),p.Q6J("ngModel",i.email),p.xp6(4),p.Q6J("ngModel",i.nombre),p.xp6(4),p.Q6J("ngModel",i.cc),p.xp6(5),p.Q6J("ngModel",i.me),p.xp6(4),p.Q6J("ngModel",i.ae),p.xp6(4),p.Q6J("ngModel",i.cvef),p.xp6(5),p.Q6J("disabled",!e.valid||i.isSaving)}}let P=(()=>{class e{constructor(e,i,o,n,t,c,a,r){this.peliculaService=e,this.funcionService=i,this.precioService=o,this.location=n,this.activatedRoute=t,this.asientoService=c,this.compraService=a,this.messageService=r,this.peliculas=[],this.funciones=[],this.precios=[],this.preciosSeleccionados=[],this.ccRegex=/[0-9]{12}$/,this.okPrecio=!1,this.okAsiento=!1,this.isSaving=!1,this.asientosSeleccionables=[],this.a=[{fila:1},{fila:2},{fila:3}],this.nodisp=[],this.selected=[],this.multi=[],this.peliculaService.query().subscribe(e=>{this.peliculas=e.body}),this.precioService.query().subscribe(e=>{this.precios=e.body,this.preciosSeleccionados=this.precios.map(e=>(e.cantidad=0,e))})}ngOnInit(){this.activatedRoute.data.subscribe(({pelicula:e})=>{this.peliculaSeleccionado=e})}onFormatoSelected(){this.funcionService.queryBoleteria(this.peliculaSeleccionado.id,this.formatoSeleccionado.id,0,1).subscribe(e=>{this.funciones=e.body})}onPrecioChange(e,i){this.preciosSeleccionados.forEach(o=>{if(o.id===e.id){let e=parseInt(i);o.cantidad=isNaN(e)?0:e}}),this.calculateTotalPrecioSelected()>this.asientosSeleccionables.reduce((e,i)=>e+i.length,0)-this.nodisp.length&&this.messageService.add({severity:"info",summary:"INFORMACION",detail:"Debe reducir la cantidad de tickets a comprar"})}canElegirAsiento(){return this.calculateTotalPrecioSelected()<=this.asientosSeleccionables.reduce((e,i)=>e+i.length,0)-this.nodisp.length}calculateSubtotal(e){return e.valor*this.preciosSeleccionados.find(i=>i.id===e.id).cantidad}calculateTotalElegido(){let e=this.preciosSeleccionados.map(e=>e.cantidad),i=0;return e.forEach(e=>i+=e),i}isPrecioSelected(){return this.preciosSeleccionados.some(e=>e.cantidad>0)}calculateTotalPrecioSelected(){return this.preciosSeleccionados.reduce((e,i)=>e+i.cantidad,0)}calculateTotal(){let e=this.preciosSeleccionados.map(e=>e.cantidad*e.valor),i=0;return e.forEach(e=>i+=e),i}onFuncionSelected(){this.asientoService.query_occupied_by_funcion(this.funcionSeleccionado.id).subscribe(e=>{this.nodisp=e.body.map(e=>e.id),this.fillAsientos()})}previousState(){this.location.back()}isDisabled(){return!1}onAsientoSelected(e){this.selected.length>=this.calculateTotalPrecioSelected()&&!this.selected.some(i=>i==e)||(this.asientosSeleccionables.map(i=>i.map(i=>{i.id===e&&(i.seleccionado=!i.seleccionado,i.seleccionado?this.selected.push(e):this.selected=[...this.selected.filter(i=>i!==e)])})),console.log(this.selected))}fillAsientos(){var e;let i=1,o=[];for(this.asientosSeleccionables=[];o=null===(e=this.funcionSeleccionado.sala)||void 0===e?void 0:e.asientos.filter(e=>e.fila==i),o=o.map(e=>{let i=this.nodisp.find(i=>i==e.id),o=this.selected.find(i=>i==e.id);return e.disponible=null==i,e.seleccionado=null!=o,e}),!(o.length<1);)this.asientosSeleccionables.push([...o]),i++}canPagar(){return this.selected.length>0&&this.selected.length==this.calculateTotalPrecioSelected()}onSubmit(){this.isSaving=!0,this.subscribeToSaveResponse(this.compraService.buy_tickets_to_funcion(new s(this.funciones.find(e=>e.id==this.funcionSeleccionado.id),this.selected,this.preciosSeleccionados.map(e=>new d(e.id,e.cantidad)),this.email,this.nombre)))}subscribeToSaveResponse(e){e.subscribe(()=>this.onSaveSuccess(),()=>this.onSaveError())}onSaveSuccess(){this.isSaving=!1,this.messageService.add({severity:"success",summary:"Ok!",detail:"Compra Exitosa"}),setTimeout(()=>{this.previousState()},1e3)}onSaveError(){this.messageService.add({severity:"error",summary:"Ok!",detail:"Hubo un error al procesar la compra"}),this.isSaving=!1}}return e.\u0275fac=function(i){return new(i||e)(p.Y36(u.I),p.Y36(g.N),p.Y36(f),p.Y36(b.Ye),p.Y36(n.gz),p.Y36(m),p.Y36(T),p.Y36(c.ez))},e.\u0275cmp=p.Xpm({type:e,selectors:[["car-boleteria"]],features:[p._Bn([])],decls:45,vars:18,consts:[[1,"card"],[1,"p-fluid","p-formgrid","p-grid","p-jc-center"],[1,"p-col-4","p-md-4",2,"margin-top","5em"],["header","Seleccion de Pelicula",3,"selected"],[1,"p-field","p-col-12","p-md-12"],["for","pelicula"],["name","pelicula","placeholder","Seleccione una Pelicula","optionLabel","tituloPais",3,"options","ngModel","required","showClear","ngModelChange"],[4,"ngIf"],["header","Seleccion de Precios",3,"disabled"],["header","Seleccion de Asiento",3,"disabled"],["class","p-grid",4,"ngFor","ngForOf"],["pButton","","pRipple","","type","button","icon","pi pi-user",1,"p-button-rounded","p-button-info"],["pButton","","pRipple","","type","button","icon","pi pi-user",1,"p-button-rounded","p-button-success"],["pButton","","pRipple","","type","button","icon","pi pi-user",1,"p-button-rounded","p-button-danger"],["pButton","","pRipple","","type","button","icon","pi pi-user",1,"p-button-rounded","p-button-secondary"],["header","Resumen Transaccion",3,"disabled"],["header","Pagar",3,"disabled"],[1,"p-grid","p-formgrid","p-grid","p-jc-center"],["for","formato"],["name","formato","placeholder","Seleccione Formato","optionLabel","nombre",3,"options","ngModel","required","showClear","ngModelChange"],["for","funcion"],["name","funcion","placeholder","Seleccione Funcion","optionLabel","nombre",3,"options","ngModel","required","showClear","ngModelChange"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["type","number","pInputText","","min","0","value","0",3,"change"],["precioInput",""],[1,"p-grid"],["class","p-col",4,"ngFor","ngForOf"],[1,"p-col"],[1,"box"],["pButton","","pRipple","","type","button","icon","pi pi-user",1,"p-button-rounded",3,"ngClass","disabled","click"],[3,"ngSubmit"],["form","ngForm"],["for","email"],["type","email","pInputText","","placeholder","email@email.com","required","","name","email",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],["for","nombreTitular"],["type","text","pInputText","","pKeyFilter","alpha","placeholder","Franco E Pinacca","required","","name","nombreTitular",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],["for","cc",2,"display","block","margin-bottom","4px"],["id","cc","type","text","name","cc","pInputText","","pKeyFilter","pnum","required","","placeholder","1234123412341234","minlength","12","maxlength","12",2,"margin-right",".5em",3,"ngModel","ngModelChange"],[1,"p-grid",2,"margin-left","1px"],[1,"p-field","p-col-4","p-md-4"],["for","mesExp"],["type","text","pInputText","","pKeyFilter","pnum","placeholder","MM","maxlength","2","required","","name","mesExp",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],["for","anoExp"],["type","text","pInputText","","pKeyFilter","pnum","placeholder","AA","maxlength","2","required","","name","anoExp",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],["for","codigoVerif"],["type","password","pInputText","","pKeyFilter","pnum","placeholder","***","maxlength","3","required","","name","codigoVerif",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],[1,"p-grid","p-jc-end"],[1,"p-col-2","p-md-2"],["pButton","","type","button","label","Volver",1,"p-button-secondary",3,"click"],["pButton","","type","submit","label","Pagar",1,"p-button-success",3,"disabled"]],template:function(e,i){1&e&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p._UZ(2,"div",2),p.TgZ(3,"div",2),p.TgZ(4,"p-accordion"),p.TgZ(5,"p-accordionTab",3),p.ynx(6),p.TgZ(7,"div",4),p.TgZ(8,"label",5),p._uU(9,"Pelicula"),p.qZA(),p.TgZ(10,"p-dropdown",6),p.NdJ("ngModelChange",function(e){return i.peliculaSeleccionado=e}),p.qZA(),p.qZA(),p.BQk(),p.YNc(11,_,5,4,"ng-container",7),p.YNc(12,C,5,4,"ng-container",7),p.qZA(),p.TgZ(13,"p-accordionTab",8),p.YNc(14,w,5,1,"ng-container",7),p.YNc(15,F,6,2,"ng-container",7),p.qZA(),p.TgZ(16,"p-accordionTab",9),p.TgZ(17,"h5"),p._uU(18,"Seleccione asientos"),p.qZA(),p.YNc(19,I,2,1,"div",10),p._UZ(20,"hr"),p._UZ(21,"div",11),p._uU(22,"Disponible "),p._UZ(23,"div",12),p._uU(24,"Adaptado "),p._UZ(25,"div",13),p._uU(26,"Ocupado "),p._UZ(27,"div",14),p._uU(28,"Seleccionado "),p.qZA(),p.TgZ(29,"p-accordionTab",15),p.TgZ(30,"p"),p._uU(31,"Usted esta por comprar "),p.TgZ(32,"b"),p._uU(33),p.qZA(),p._uU(34," boletos para la funcion "),p.TgZ(35,"b"),p._uU(36),p.qZA(),p._uU(37," por un precio de "),p.TgZ(38,"b"),p._uU(39),p.qZA(),p.qZA(),p.qZA(),p.TgZ(40,"p-accordionTab",16),p.YNc(41,k,33,7,"ng-container",7),p.qZA(),p.qZA(),p.qZA(),p._UZ(42,"div",2),p.qZA(),p._UZ(43,"div",17),p.qZA(),p._UZ(44,"p-toast")),2&e&&(p.xp6(5),p.Q6J("selected",!0),p.xp6(5),p.Q6J("options",i.peliculas)("ngModel",i.peliculaSeleccionado)("required",!0)("showClear",!0),p.xp6(1),p.Q6J("ngIf",i.peliculaSeleccionado),p.xp6(1),p.Q6J("ngIf",i.formatoSeleccionado),p.xp6(1),p.Q6J("disabled",null==i.funcionSeleccionado),p.xp6(1),p.Q6J("ngIf",i.funcionSeleccionado),p.xp6(1),p.Q6J("ngIf",i.funcionSeleccionado),p.xp6(1),p.Q6J("disabled",!i.isPrecioSelected()||!i.canElegirAsiento()),p.xp6(3),p.Q6J("ngForOf",i.asientosSeleccionables),p.xp6(10),p.Q6J("disabled",!i.canPagar()),p.xp6(4),p.hij("",i.calculateTotalPrecioSelected()," "),p.xp6(3),p.hij("",null==i.funcionSeleccionado?null:i.funcionSeleccionado.nombre," "),p.xp6(3),p.hij("$ ",i.calculateTotal(),""),p.xp6(1),p.Q6J("disabled",!i.canPagar()),p.xp6(1),p.Q6J("ngIf",!0))},directives:[S.UQ,S.US,v.Lt,q.JJ,q.On,q.Q7,b.O5,b.sg,x.Hq,t.FN,A.iA,c.jx,M.o,b.mk,q._Y,q.JL,q.F,q.Fj,y.Fr,q.wO,q.nD],encapsulation:2}),e})();const E=[{path:"",component:P,data:{pageTitle:"CineAr"}},{path:":id",resolve:{pelicula:l.Z},component:P,data:{pageTitle:"CineAr"}}];let B=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({providers:[c.ez],imports:[[n.Bz.forChild(E),t.EV,a.M,r.kT,b.ez]]}),e})()}}]);